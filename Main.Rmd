---
title: "Proyecto de estadística: Etapa 2"
author: 
  - Sebastián Rojas Vargas
  - Francisco Soto Quesada
  - Jairo Pacheco Campos
  - Jason Barrantes Rodríguez
date: "17/4/2021"
output: word_document
---

# Lista de librerías utilizadas

```{r setup, message=F, warning=F, echo = T, results = 'hide'}
library(visdat)
library(ggplot2)
library(DataExplorer)
library(datos)
library(EnvStats)
library(stests)
library("ggpubr")
library(stats)
library(BSDA)
library(PASWR2)
library(TeachingDemos)
```

# I Parte: explicación de los datos

A continuación, se presenta una tabla con los principales aspectos del dataset utilizado.

**Dataset:** Diamantes

**Descripción general:** se optó por la utilización del dataset de diamantes del paquete de datos de R. El motivo de la elección de este es que cuenta con una gran cantidad de datos y columnas. Estas últimas siendo de gran variedad entre datos cualitativos y cuantitativos. Además de todo esto el dataset cuenta con todas sus variables y sus datos ya traducidos al español, facilitando así la comprensión de los datos.

**Filas:** 53 940

**Columnas:** 10

**Resumen del dataset:**

```{r}
str(diamantes)
```

**Resumen de los datos:**

```{r}
vis_dat(diamantes)
plot_missing(diamantes)
```

En esta última imagen se puede observar que no hay datos faltantes en las columnas del dataset. Esto facilita los cálculos que se vean a realizar más adelante ya que no hay necesidad de filtrar los datos faltantes.

## Resumen de variables seleccionadas

| Variables| Tipos| Descripción| Parámetro por estimar (IC)|
|:--|:--|:--|:--|
| Precio| Cuantitativa| Precio en dólares estadounidenses| Promedio usando distribución z y distribución t|
| Corte| Cualitativa| Calidad del corte (Regular, Bueno, Muy bueno, Premium, Ideal)| Proporción, diferencia de proporciones|
| Profundidad| Cuantitativa| Porcentaje de la profundidad total en milímetros| Diferencia de promedios usando distribución z y distribución t|
| Quilates| Cuantitativa| Peso del diamante| Cociente de varianzas y varianza.

# II Parte: Análisis Inferencial (IC)

## IC de un promedio usando distribución Z

A continuación, se presentan los promedios usando distribución normal estándar de una población de datos extraídos del dataset diamantes, utilizando los siguientes datos de la variable precio del dataset de diamantes:

```{r}
set.seed(4562) # semilla

poblacion <- as.data.frame(diamantes)
poblacion.precios <- poblacion$precio

n1 <- length(poblacion.precios)
mu1 <- mean(poblacion.precios)
var1 <- var(poblacion.precios)

```

| Muestra| Tamaño| Promedio| Varianza|
|:--|:--|:--|:--|
| A| `r n1`| `r mu1`| `r var1`|

**Hipótesis asumidas** 

Dado que la muestra es mayor a 30 se puede asumir que la población sigue una distribución normal y que se puede aproximar σ₁ mediante s₁.

**Cálculo**

Conociendo los datos se puede aproximar el IC utilizando la función z.test de las librerías stests BSDA y PASWR2.


Para stests los parámetros son los siguientes:

* **x:** vector numérico que representa la muestra
* **sigma2:** varianza de la muestra
* **conf.level:** nivel de confidencia (opcional, se asume 0.95 por defecto)

```{r}
stests::z.test(
  x = poblacion.precios, 
  sigma2 = var(poblacion.precios), 
  conf.level = 0.95
  )$conf.int
```


Los parámetros tanto para BSDA y PASWR2 son los siguientes:

* **x:** la muestra
* **sigma.x:** desviación estándar de la muestra
* **conf.level:** nivel de confidencia (opcional, se asume 0.95 por defecto)

```{r}
BSDA::z.test(
  x = poblacion.precios, 
  sigma.x = sqrt(var(poblacion.precios)), 
  conf.level = 0.95
  )$conf.int
```
```{r}
IC <- PASWR2::z.test(
  x = poblacion.precios, 
  sigma.x = sqrt(var(poblacion.precios)), 
  conf.level = 0.95
  )$conf.int

IC
```

**Conclusiones**

De los resultados obtenidos, se puede concluir que como la media de precios del dataset diamantes `r mean(poblacion.precios)` se encuentra en el intervalo ]`r IC`[ obtenido de tres librerías distintas, todo está correcto.

## IC de un promedio usando distribución t
A continuación, se presentan los Promedios usando distribución t de una población, utilizando muestras de la variable precio del dataset de diamantes.

```{r}
## Se toman filas random para sacar del dataset
set.seed(6894)
filas.random <- sample(1:53940, 20, replace= T)

## Se generan datasets nuevos con las filas random anteriores 
muestra1 <- as.data.frame(diamantes[filas.random,])
muestra.precios <- muestra1$precio
n1 <- length(muestra.precios)
mu1 <- mean(muestra.precios)
de1 <- sqrt(var(muestra.precios))
alpha1 <- 0.05

```

| Muestra| Tamaño| Promedio| Desviación estandar|
|:--|:--|:--|:--|
| A| `r n1`| `r mu1`| `r de1`|

En este caso dado que el tamaño de la muestra es menor a 30 se ha optado por realizar una inspección visual de los datos para ver si se asemeja a una distribución normal.

```{r echo=FALSE}
ggdensity(muestra1$profundidad, 
          main = "Gráfico de densidad de la profundidad de la muestra A",
          xlab = "Precio de los diamantes")
```

**Hipótesis asumidas**

Como se puede observar, la muestra tiene forma de campana, por lo que se puede asumir que sigue una distribución normal. 

**Cálculo**

Conociendo esto se puede aproximar el IC mediante la función t.test, la cual tiene la siguiente estructura, con los siguientes parámetros:

* **x:** muestra
* **conf.level:** nivel de confidencia

```{r}
IC <- t.test(
  x = muestra.precios,
  conf.level = 0.95
  )$conf.int

IC
```

**Conclusión**

De los resultados obtenidos, se puede concluir que como la media de precios del dataset de diamantes `r mean(as.data.frame(diamantes)$precio)` se encuentra en el intervalo ]`r IC`[, todo está correcto, aunque comparándolo con el IC de la distribución Z, este posee menor precisión debido a la poca cantidad de datos que fueron brindados.

## IC de una proporción

A continuación, se presenta la proporción para una población de datos tomados del dataset diamantes, para ello se ha utilizado una muestra de la variable "corte" donde se incluyen todos los diamantes cuyo corte sea de tipo "Premium" o "Ideal", utilizando una muestra de gama alta de la siguiente manera:

```{r}
gamaAlta <- diamantes[diamantes$corte == "Premium" | diamantes$corte == "Ideal",]
length(gamaAlta$corte)
```

| Gama| Corte| Tamaño de muestra|
|:--|:--|:--|
| Alta| Premium e Ideal| `r length(gamaAlta$corte)`| 

Como sabemos el dataset diamantes contiene una variable llamada corte, de igual manera, este dataset contiene otra variable llamada color. Estas variables las utilizaremos para saber cuál es la proporción que existe de un diamante de corte premium o ideal que hemos llamado gama alta con respecto al color que este posee. Para ello utilizamos la población de diamantes de gama alta que sean de color tipo D:

```{r}
exitos.alta <- gamaAlta[gamaAlta$color == "D",]
length(exitos.alta$color)
```

| Color| Tamaño de muestra|
|:--|:--|
| D| `r length(exitos.alta$color)`| 

**Hipótesis asumidas**

Antes de realizar las operaciones se debe verificar que np > 5 y nq > 5

Para ello tenemos los siguientes datos:

$$p = \frac{x}{n} = \frac{4437}{35342} = 0.1255446777$$
$$np = 35342 * 0.1255446777 = 4437$$
$$q = 1-p = 1 - 0.1255446777 = 0.8744553223$$
$$nq = 35342 * 0.8744553223 = 30905$$
                                        
Como ambos valores son mayores a 5 es posible obtener la proporción. Una vez conocidos estos datos se puede calcular el IC de la proporción, para esto se implementa la función prop.test para una población de la siguiente manera:

**Cálculo**

Una vez conociendo todos los datos, se procede a calcular el intervalo de confianza para una proporción con un nivel de confianza del 95%:

```{r}
prop.test(x=length(exitos.alta$color), n=length(gamaAlta$corte), conf.level = 0.95)$conf.int
```

En donde:

* **x:** vector con el conteo de éxitos de la muestra
* **n:** vector con el número de ensayos la muestra
* **conf.level:** nivel de confianza

**Conclusiones**

De los resultados obtenidos se puede observar que el intervalo resultante es muy pequeño, esto debido a la gran cantidad de datos que se usaron para realizar el cálculo.

## IC de una diferencia de proporciones

A continuación, se presenta la diferencia de proporciones para dos poblaciones de datos tomados del dataset diamantes, para ello se han utilizado dos muestras de la variable "corte" donde en la primera se incluyen todos los diamantes cuyo corte sea de tipo "Premium" ó "Ideal" (muestra de gama alta) y la segunda muestra donde se incluyen todos los diamantes cuyo corte sea de tipo "Regular" ó  "Bueno" (muestra de gama baja), de la siguiente manera:

```{r}
gamaAlta <- diamantes[diamantes$corte == "Premium" | diamantes$corte == "Ideal",]
length(gamaAlta$corte)
gamaBaja <- diamantes[diamantes$corte == "Regular" | diamantes$corte == "Bueno",]
length(gamaBaja$corte)

exitos.alta <- gamaAlta[gamaAlta$color == "D",]
length(exitos.alta$color)
exitos.baja <- gamaBaja[gamaBaja$color == "D",]
length(exitos.baja$color)
```

| Gama| Corte| Tamaño de muestra|
|:--|:--|:--|
| Alta| Premium e Ideal| `r length(gamaAlta$corte)`|
| Baja| Regular y Bueno| `r length(gamaBaja$corte)`| 

Como sabemos el dataset diamantes contiene una variable llamada corte, de igual manera, este dataset contiene otra variable llamada color. Estas variables las utilizaremos para saber cuál es la diferencia de proporciones que existen de un diamante de gama alta y de gama baja con respecto al color que este posee. Para ello utilizamos la población de diamantes de gama alta y baja que sean de color tipo D para representar los éxitos:

| Gama | Color| Tamaño de muestra|
|:--|:--|:--|
| Alta| D| `r length(exitos.alta$color)`|
| Baja| D| `r length(exitos.baja$color)`| 

**Hipótesis asumidas**

Antes de realizar las operaciones se debe verificar que np > 5 y nq > 5 para las dos poblaciones

Para ello tenemos los siguientes datos para la primera población: 

$$p_{1} = \frac{x_{1}}{n_{1}} = \frac{4437}{35342} = 0.1255446777$$
$$n_{1}p_{1} = 35342 * 0.1255446777 = 4437$$
$$q_{1} = 1-p_{1} = 1 - 0.1255446777 = 0.8744553223$$
$$n_{1}q_{1} = 35342 * 0.8744553223 = 30905$$

Y tenemos los siguientes datos para la segunda población: 

$$p_{2} = \frac{x_{2}}{n_{2}} = \frac{825}{6516} = 0.126611418$$
$$n_{2}p_{2} = 6516 * 0.126611418 = 825$$
$$q_{2} = 1-p_{2} = 1 - 0.126611418 = 0.873388582$$
$$n_{2}q_{2} = 6516 * 0.873388582 = 5691$$
  
                                        
Como ambos valores son mayores a 5 significa que si se puede realizar la diferencia de proporciones. Una vez conocidos estos datos se puede calcular el IC para la diferencia de proporciones, para esto se implementa la función prop.test para dos poblaciones de la siguiente manera:


```{r}
prop.test(x = c(length(exitos.alta$color) , length(exitos.baja$color)), n = c(length(gamaBaja$corte), length(gamaAlta$corte)), conf.level = 0.95)$conf.int
```

En donde:

* **x:** vector con el conteo de éxitos de la muestra
* **n:** vector con el número de ensayos la muestra
* **conf.level:** nivel de confianza

De la cual se puede concluir que la proporción de la muestra A es mayor que el de la muestra B.

## IC de una diferencia de promedios usando distribución z

Para este ejemplo se utilizarán dos grupos. En primer lugar, está el grupo de diamantes que se considera que tienen un color de buena calidad, este grupo está compuesto de aquellos diamantes cuyo color es "D", "E" o "F". Luego se tiene el grupo diamantes cuyo color es de peor calidad, el cual está compuesto por los diamantes con colores "H", "I" o "J". Ambos grupos están distribuidos de la siguiente manera:

```{r}
buenaCalidad <- diamantes[diamantes$color == "D" | diamantes$color == "E" | diamantes$color == "F",]
peorCalidad <- diamantes[diamantes$color == "H" | diamantes$color == "I" | diamantes$color == "J",]

length(buenaCalidad$color)
length(peorCalidad$color)
```

| Calidad| Colores| Tamaño de muestra|
|:--|:--|:--|
| Buena| D, E o F| `r length(buenaCalidad$color)`|
| Peor| H, I o J| `r length(peorCalidad$color)`|

**Hipótesis asumidas**

Dado que ambas muestras son mayores a 30 se puede asumir que ambas siguen una distribución normal y que se puede aproximar σ₁ y σ₂ mediante s₁  y s₂.

**Cálculo**

Una vez obtenidos estos datos se desea calcular la diferencia de promedios de profundidad entre la población de buena calidad y la de peor calidad con un intervalo de confianza del 95%. Para esto se hace uso de las siguientes funciones:

```{r}
BSDA::z.test(x = buenaCalidad$profundidad, y = peorCalidad$profundidad, sigma.x = sd(buenaCalidad$profundidad), sigma.y = sd(peorCalidad$profundidad), conf.level = 0.95)$conf.int
PASWR2::z.test(x = buenaCalidad$profundidad, y = peorCalidad$profundidad, sigma.x = sd(buenaCalidad$profundidad), sigma.y = sd(peorCalidad$profundidad), conf.level = 0.95)$conf.int
```

Ambas funciones aplican para una y dos poblaciones y están compuestas de los siguientes parámetros, en donde:

* **x:** vector numérico que representa la primera muestra
* **y:** vector numérico que representa la segunda muestra (opcional)
* **sigma.x:** desviación estándar de x (opcional)
* **sigma.y:** desviación estándar de y (opcional)
* **conf.level:** nivel de confianza entre 0 y 1 (opcional, se asume 0.95 por defecto)

**Conclusiones**

De los resultados obtenidos para la diferencia de promedios se puede concluir que la media de profundidad de diamantes con colores de baja calidad es mayor que la diamantes con colores de alta calidad.

## IC de una diferencia de promedios usando distribución t

Para este caso se utilizarán muestras aleatorias sin reemplazo de tamaño 25 de los dos grupos utilizados en el cálculo anterior (diamantes con color de buena calidad y diamantes con color de peor calidad).

```{r}
# Se sacan los datos de la calidad
buenaCalidad <- diamantes[diamantes$color == "D" | diamantes$color == "E" | diamantes$color == "F",]
peorCalidad <- diamantes[diamantes$color == "H" | diamantes$color == "I" | diamantes$color == "J",]

# Se toman las filas para las muestras aleatorias
set.seed(6894)
filas.randomMejorCalidad <- sample(1:length(buenaCalidad$color), 25, replace= F)
filas.randomPeorCalidad <- sample(1:length(peorCalidad$color), 25, replace= F)

muestraMejorCalidad <- as.data.frame(buenaCalidad[filas.randomMejorCalidad,])
muestraPeorCalidad <- as.data.frame(peorCalidad[filas.randomPeorCalidad,])

length(muestraMejorCalidad$color)
length(muestraPeorCalidad$color)
```

| Calidad| Colores| Tamaño de muestra|
|:--|:--|:--|
| Buena| D, E o F| `r length(muestraMejorCalidad$color)`|
| Peor| H, I o J| `r length(muestraPeorCalidad$color)`|

En este caso dado que los tamaños de las muestras son menores a 30 se ha optado por realizar una inspección visual de los datos para ver si se asemejan a una distribución normal

```{r echo=FALSE}
ggdensity(muestraMejorCalidad$profundidad, 
          main = "Gráfico de densidad de la profundidad de la muestra A",
          xlab = "Profundidad de los diamantes")
```

```{r echo=FALSE}
ggdensity(muestraPeorCalidad$profundidad, 
          main = "Gráfico de densidad de la profundidad de la muestra B",
          xlab = "Profundidad de los diamantes")
```

**Hipótesis asumidas**

Como se puede observar ambas muestras tienen forma de campana, por lo que se puede asumir que siguen una distribución normal. Además, también se asume que las varianzas son iguales. Sin embargo, como las muestras son pequeñas no se pueden utilizar s₁  y s₂ para realizar una aproximación σ₁ y σ₂.

**Cálculo**

Una vez obtenidos estos datos se desea calcular la diferencia de promedios de profundidad entre las muestras de buena calidad y las de peor calidad con un intervalo de confianza del 95%. Para esto se hace uso de la siguiente función:

```{r}
t.test(x=muestraMejorCalidad$profundidad, y=muestraPeorCalidad$profundidad, conf.level = 0.95, var.equal = TRUE)$conf.int
```

Donde:

* **x:** primera muestra
* **y:** segunda muestra
* **conf.level:** nivel de confidencia
* **var.equal:** si las varianzas se asumen iguales

**Conclusión**

A diferencia del caso anterior, dado a que las muestras aquí son más pequeñas, se puede observar que hay tanto valores negativos como positivos, por lo cual no se puede llegar a una conclusión con certeza ya que existe la posibilidad de que ambas muestras sean iguales o que una sea mayor que otra.

## IC de una varianza
A continuación, se presenta IC de la varianza de la variable quilates del dataset diamantes.

| Muestra| Tamaño|
|:--|:--|
| A| `r length(diamantes$quilate)`|

Una vez tenemos la muestra, utilizaremos la variable de quilates para obtener el IC de varianza de la muestra, para esto utilizaremos la librería EnvStats y específicamente su método varTest que nos dará el intervalo que estamos buscando.

Antes de realizar el cálculo debemos tener en cuenta lo siguiente:

* El nivel de confianza utilizado será de 95%
* La muestra sigue una distribución normal

**Cálculo**

El código utilizado para este cálculo fue:

```{r}
P1 <- varTest(diamantes$quilate, conf.level = 0.95)$conf.int
P1
```

Donde:

* **Primer parametro:** primera muestra
* **conf.level:** nivel de confidencia

**Conclusión**

Dando Como resultado el IC de varianza:
]`r P1`[ , como podemos ver el intervalo es muy pequeño y esto se debe a que se usaron una gran cantidad de datos para realizar el cálculo, dando un resultado muy preciso.


## IC de un cociente de varianzas
Gracias a la librería stests podemos realizar el cociente de varianza de dos poblaciones, para esto dividiremos el dataset de diamantes de dos poblaciones la primera contendrá los diamantes que tengan una alta claridad, teniendo como la más baja calidad posible para esta población VS1 y una segunda población que estará compuesta por los diamantes que tengan una claridad igual o inferior a VS2.


```{r}
claridadAlta <- diamantes[diamantes$claridad == "IF" | diamantes$claridad == "VVS1" | diamantes$claridad == "VVS2" |
diamantes$claridad == "VS1",]
length(claridadAlta$quilate)

clariadadBaja <- diamantes[diamantes$claridad == "VS2" | diamantes$claridad == "SI1" | diamantes$claridad == "SI2" | 
diamantes$claridad == "I1",]
length(clariadadBaja$quilate)
```

| Calidad| Claridad| Tamaño de muestra|
|:--|:--|:--|
| Alta| IF, VVSS1, VVSS2, VS1| `r length(claridadAlta$claridad)`|
| Baja| VS2, SI1, SI2, I1| `r length(clariadadBaja$claridad)`|


Antes de realizar el cálculo debemos tener en cuenta lo siguiente:

* El nivel de confianza utilizado será de 95%.
* La población 1 y la población 2 se comportan normalmente.

**Cálculo**

El código utilizado para este cálculo fue:

```{r}
R <- stests :: var.test(claridadAlta$quilate, clariadadBaja$quilate,conf.level = 0.95)$conf.int
R
```

Donde:

* **Primer parametro:** primera muestra
* **Segundo parametro:** segunda muestra
* **conf.level:** nivel de confidencia

**Conclusión**

Dando como resultado:
]`r R`[

En conclusión, al resultado obtenido podemos ver que las varianzas de estas dos poblaciones no deberían ser iguales ya que el número 1 no pertenece al intervalo, también podemos decir que la varianza de la segunda población es mayor ya que ambos valores son menores que 1.

# III Parte: Análisis Inferencial (pruebas de hipótesis de una y dos poblaciones)

## Resumen de variables seleccionadas

**Una población:**

| Variables| Tipos| Descripción| Parámetro por estimar (IC)|
|:--|:--|:--|:--|
| Precio| Cuantitativa| Precio en dólares estadounidenses| Promedio usando distribución z y distribución t|
| Corte| Cualitativa| Calidad del corte (Regular, Bueno, Muy bueno, Premium, Ideal)| Proporción |
| Quilates| Cuantitativa| Peso del diamante| Varianza

**Dos poblaciones:**

| Variables| Tipos| Descripción| Parámetro por estimar (IC)|
|:--|:--|:--|:--|
| Corte| Cualitativa| Calidad del corte (Regular, Bueno, Muy bueno, Premium, Ideal)| Diferencia de proporciones|
| Profundidad| Cuantitativa| Porcentaje de la profundidad total en milímetros| Diferencia de promedios usando distribución z y t y cociente de varianzas|

## Prueba de hipótesis para un promedio usando distribución Z

Para este ejemplo se utilizarán dos grupos (los mismo utilizados para la prueba del IC para un promedio usando distribución Z). Utilizando todos los datos de la variable precio extraídos del dataset diamantes. Tal está distribuido de la siguiente manera:

```{r}
set.seed(4562) # semilla

poblacion <- as.data.frame(diamantes)
poblacion.precios <- poblacion$precio

n1 <- length(poblacion.precios)
mu1 <- mean(poblacion.precios)
var1 <- var(poblacion.precios)

n1
```

| Muestra| Tamaño| Promedio| Varianza|
|:--|:--|:--|:--|
| A| `r n1`| `r mu1`| `r var1`|

**Hipótesis asumidas**

Dado que la muestra es mayor a 30 se puede asumir que la población sigue una distribución normal y que se puede aproximar σ₁ mediante s₁.


**Cálculo**

Sea:

* $\mu_{p}$: la media del precio de los diamantes

Y dadas las siguientes hipótesis para la prueba:

* $H_{0}: \mu_{p} = 4000$
* $H_{1}: \mu_{p} > 4000$

Una vez obtenidos estos datos se procede a realizar la prueba de hipótesis haciendo uso de las siguientes funciones:

```{r}
stests::z.test(
  x = poblacion.precios, 
  sigma2 = var(poblacion.precios), 
  mu = 4000, alternative = "greater"
)

BSDA::z.test(
  x = poblacion.precios, 
  sigma.x = sd(poblacion.precios), 
  mu = 4000, alternative = "greater"
)

PASWR2::z.test(
  x = poblacion.precios, 
  sigma.x = sd(poblacion.precios), 
  mu = 4000, alternative = "greater"
)

```

Las funciones BSDA y PASWR2 aplican para una y dos poblaciones y están compuestas de los siguientes parámetros, en donde:

* **x:** vector numérico que representa la primer muestra
* **sigma.x:** desviación estándar de x (opcional)
* **mu:** el valor de la media o la diferencia de medias en la hipótesis nula
* **alternative:** indica si la prueba es de cola izquierda (less), derecha (greater) o de dos colas (two.sided)

En cambio las funciones de stests solo aplican para una población, la cual cuenta con los parámetros donde:

* **x:** vector numérico que representa la primer muestra
* **sigma2:** varianza de x (opcional)
* **mu:** el valor de la media o la diferencia de medias en la hipótesis nula
* **alternative:** indica si la prueba es de cola izquierda (less), derecha (greater) o de dos colas (two.sided)

**Resumen de la prueba**

| Dato| Valor|
|:--|:--|
| Valor observado| $z_{obs}$|
| Estadístico de prueba| $\tilde{x}_p$|
| Región de aceptación| ]3904.545, +$\infty$[|
| Región de rechazo| ]-$\infty$, 3904.545[|
| Nivel de confianza| 0.95|

**Conclusiones**

No se encontró evidencia en contra $H_{0}$ por lo cual se puede asumir que la media de los precios de diamantes es menor o igual a 4000 dólares estadounidenses. Esto concordando también con los resultados del valor P, donde se tiene una aceptación fuerte de $H_{0}$.

## Prueba de hipótesis para un promedio usando distribución t

Para este caso se utilizarán muestras las mismas muestras del caso anterior (precio de los diamantes), pero esta vez con una muestra de 20 datos.

```{r}
## Se toman filas random para sacar del dataset
set.seed(6894)
filas.random <- sample(1:53940, 20, replace= T)

## Se generan datasets nuevos con las filas random anteriores 
muestra1 <- as.data.frame(diamantes[filas.random,])
muestra.precios <- muestra1$precio
n1 <- length(muestra.precios)
mu1 <- mean(muestra.precios)
de1 <- sqrt(var(muestra.precios))
alpha1 <- 0.05

```

| Muestra| Tamaño| Promedio| Desviación estandar|
|:--|:--|:--|:--|
| A| `r n1`| `r mu1`| `r de1`|

En este caso dado que el tamaño de la muestra es menor a 30 se ha optado por realizar una inspección visual de los datos para ver si se asemeja a una distribución normal.

```{r echo=FALSE}
ggdensity(muestra1$profundidad, 
          main = "Gráfico de densidad de la profundidad de la muestra A",
          xlab = "Precio de los diamantes")
```

**Hipótesis asumidas**

Como se puede observar, la muestra tiene forma de campana, por lo que se puede asumir que sigue una distribución normal. 

**Cálculo**

Sea:

* $\mu_{p}$: la media del precio de los diamantes

Y dadas las siguientes hipótesis para la prueba:

* $H_{0}: \mu_{p} = 4000$
* $H_{1}: \mu_{p} > 4000$

Una vez obtenidos estos datos se procede a realizar la prueba de hipótesis haciendo uso de la siguient función:


```{r}
t.test(
  x = muestra.precios, 
  mu = 4000, alternative = "greater"
  )
```

La función está compuesta de los siguientes parámetros, en donde:

* **x:** vector numérico que representa la primera muestra
* **mu:** el valor de la media o la diferencia de medias en la hipótesis nula
* **alternative:** indica si la prueba es de cola izquierda (less), derecha (greater) o de dos colas (two.sided)

**Resumen de la prueba**

| Dato| Valor|
|:--|:--|
| Valor observado| $t_{obs}$|
| Grados de libertad| 19|
| Estadístico de prueba| $\tilde{x}_t$|
| Región de aceptación| ]2664.219, +$\infty$[|
| Región de rechazo| ]-$\infty$, 2664.219[|
| Nivel de confianza| 0.95|

**Conclusiones**

No se encontró evidencia en contra $H_{0}$ por lo cual se puede asumir que la media del precio de los diamantes es menor o igual a 4000 dólares estadounidenses. Esto concordando también con los resultados del valor P, donde se tiene una aceptación de $H_{0}$.



## Prueba de hipótesis para una proporción

```{r include=FALSE}
library(datos)
library(stats)




gamaAlta <- diamantes[diamantes$corte == "Premium" | diamantes$corte == "Ideal",]
tamañoMuestraGama <- length(gamaAlta$corte)


exitos.alta <- gamaAlta[gamaAlta$color == "D",]
tamañoMuestraColor <-length(exitos.alta$color)



prop.test(x=length(exitos.alta$color), n=length(gamaAlta$corte), p = 0.12, alternative = "less", conf.level = 0.95)

```

Basado en la experiencia, un joyero afirma que mínimo el 12% de los diamantes de gama alta son de color tipo D

¿Podemos aceptar la afirmación del joyero?

Para realizar la prueba, se consideran las siguientes hipótesis:

\(H_{0}:p =0.12(\geq )\)

\(H_{1}:p < 0.12\)

dónde p representa la proporción de que unos diamantes de gama alta elegidos al azar, sean de color tipo D. La prueba a realizar es de cola izquierda.

En R se está implementado la función prop.test, que además también sirve para contrastar dos proporciones por medio de muestras independientes grandes.

Su sintaxis es:

              prop.test(x, n, p = ..., alternative = ..., conf.level = ...)

donde:

* **n** es el tamaño de la muestra.

* **x** es el número de éxitos de la muestra.

* **p** es la proporción poblacional que contrastamos.

* **alternative** especifica la hipótesis alternativa, debe ser "two.sided", "greater" o "less". 
* **conf.level** es el nivel de confianza.


Para obtener el valor n se tomaron lo datos del dataset "Diamantes" donde se utilizó una muestra de la variable "corte" incluyendosen todos los diamantes cuyo corte sea de tipo "Premium" o "Ideal", siendo esta una muestra de diamantes de gama alta, de la siguiente manera:


```{r}
gamaAlta <- diamantes[diamantes$corte == "Premium" | diamantes$corte == "Ideal",]
gamaAlta
tamañoMuestraGama <- length(gamaAlta$corte)
tamañoMuestraGama

```

| Gama| Corte| Tamaño de muestra|
|:--|:--|:--|
| Alta| Premium e Ideal| `r tamañoMuestraGama`| 



Para obtener el valor x se incorporó la variable color del dataset "Diamantes" para saber cual es numero de diamantes que hay de corte "premium" o "Ideal" (que hemos llamado gama alta) de color tipo D, de la siguiente manera:

```{r}
exitos.alta <- gamaAlta[gamaAlta$color == "D",]
exitos.alta
tamañoMuestraColor <-length(exitos.alta$color)
tamañoMuestraColor
```

| Gama| Corte| Color| Tamaño de muestra|
|:--|:--|:--|:--|
| Alta| Premiun e Ideal | D| `r tamañoMuestraColor`| 


Antes de realizar las operaciones se debe verificar que np > 5 y nq > 5

Para ello tenemos los siguientes datos:

p = x/n = 4437/35342 = 0.1255446777

np = 35342 * 0.1255446777 = 4437
                                        
q = 1-p = 1 - 0.1255446777 = 0.8744553223
                                        
nq = 35342 * 0.8744553223 = 30905

                                        
Como ambos valores son mayores a 5 se procede a utilizar la función prop.test con sus respectivos valores
```{r}
prop.test(x=length(exitos.alta$color), n=length(gamaAlta$corte), p = 0.12, alternative = "less", conf.level = 0.95)
```


**Resumen de la prueba**

| Dato| Valor|
|:--|:--|
| Valor observado| $z_{obs}$ = 3.199531216|
| Grados de libertad| no corresponde|
| Estadístico de prueba| $\tilde{p}$ = 0.1255447|
| Región de aceptación| ]0.0000000, 0.1284867[|
| Región de rechazo| ]0.1284867, 1[|
| Nivel de confianza| 0.95|


Conclusion:

\(H_{0}\) no puede ser rechazado dado que no se encontró evidencia suficiente para rechazarlo, ya que según lo observado el 12 se encuentra dentro del intervalo de aceptación y el valor p es mayor que el valor de alfa por lo que lo ubica en la region de aceptación, y por ende se asume como verdadera la afirmación del joyero.  

## Prueba de hipótesis para una diferencia de proporciones

```{r include=FALSE}
library(datos)
library(stats)




gamaBaja <- diamantes[diamantes$corte == "Regular" | diamantes$corte == "Bueno",]
gamaBaja

gamaAlta <- diamantes[diamantes$corte == "Premium" | diamantes$corte == "Ideal",]
gamaAlta



tamañoMGB <- length(gamaBaja$corte)
tamañoMGA <- length(gamaAlta$corte)



exitos.baja <- gamaBaja[gamaBaja$color == "D",]
exitosBaja <- length(exitos.baja$color) 

exitos.alta <- gamaAlta[gamaAlta$color == "D",]
exitosAlta <- length(exitos.alta$color)




prop.test(x = c(length(exitos.alta$color) , length(exitos.baja$color)), n = c(length(gamaAlta$corte), length(gamaBaja$corte)))
```


Para las pruebas de contraste de proporciones para muestras grandes, se utilizará la función prop.test

Su sintaxis es:

              prop.test(x, n, p = ..., alternative = ..., conf.level = ...)

donde:

* **n** es un vector de dos entradas de los respectivos tamaños de las muestras.

* **x** es el vector de dos numeros naturales que representan los éxitos ambas muestras.


Es este ejercicio se contrastará si la proporción de diamantes de gama alta de color tipo D es la misma que la proporción de diamantes de gama baja de color tipo D

Para realizar esta prueba, se considerarán las siguientes hipótesis:

\(H_{0}:p_{a}-p_{b} = 0\)

\(H_{1}:p_{a}-p_{b} \neq 0\)


Para obtener el valor n se tomaron dos muestras de la variable "corte", en la primera muestra se inculyen todos los diamantes cuyo corte sea de tipo "Premium" ó "Ideal" (muestra de gama alta) y la segunda muestra donde se incluyen todos los diamantes cuyo corte sea de tipo "Regular" ó  "Bueno" (muestra de gama baja), de la siguiente manera:


```{r}
gamaAlta <- diamantes[diamantes$corte == "Premium" | diamantes$corte == "Ideal",]
gamaAlta

gamaBaja <- diamantes[diamantes$corte == "Regular" | diamantes$corte == "Bueno",]
gamaBaja

tamañoMGA <- length(gamaAlta$corte)
tamañoMGA

tamañoMGB <- length(gamaBaja$corte)
tamañoMGB

```


| Gama| Corte| Tamaño de muestra|
|:--|:--|:--|
| Alta| Premium e Ideal| `r tamañoMGA`| 


| Gama| Corte| Tamaño de muestra|
|:--|:--|:--|
| Baja| Regular y Bueno| `r tamañoMGB`| 



Para obtener el valor x se incorporó la variable color del dataset "Diamantes", con el fin de calcular cuantos diamantes de gama alta y baja son de color tipo D, de la siguiente manera:

```{r}
exitos.alta <- gamaAlta[gamaAlta$color == "D",]
exitos.alta

exitos.baja <- gamaBaja[gamaBaja$color == "D",]
exitos.baja


exitosAlta <- length(exitos.alta$color)
exitosAlta

exitosBaja <- length(exitos.baja$color) 
exitosBaja
```

| Gama | Color| Tamaño de muestra|
|:--|:--|:--|
| Alta| D| `r exitosAlta`| 

| Gama | Color| Tamaño de muestra|
|:--|:--|:--|
| Baja| D| `r exitosBaja`| 




Antes de realizar las operaciones se debe verificar que np > 5 y nq > 5 para las dos poblaciones

Para ello tenemos los siguientes datos para la primer población: 

p1 = x1/n1 = 4437/35342 = 0.1255446777

n1p1 = 35342 * 0.1255446777 = 4437

q1 = 1-p1 = 1 - 0.1255446777 = 0.8744553223

n1q1 = 35342 * 0.8744553223 = 30905
  
  
Y tenemos los siguientes datos para la segunda población: 

p2 = x2/n2 = 825/6516 = 0.126611418

n2p2 = 6516 * 0.126611418 = 825

q2 = 1-p2 = 1 - 0.126611418 = 0.873388582

n2q2 = 6516 * 0.873388582 = 5691
  

                                        
Como ambos valores son mayores a 5 se procede a utilizar la función prop.test con sus respectivos valores
```{r}
prop.test(x = c(length(exitos.alta$color) , length(exitos.baja$color)), n = c(length(gamaAlta$corte), length(gamaBaja$corte)))
```


**Resumen de la prueba**

| Dato| Valor|
|:--|:--|
| Valor observado| $z_{obs}$ = -0.0010667|
| Grados de libertad| no corresponde|
| Estadístico de prueba| $\tilde{p_1}$ = 0.1255447  $\tilde{p_2}$ = 0.1266114|
| Región de aceptación| ]-0.009939703, 0.007806222[|
| Región de rechazo| ]-$\infty$, -0.009939703[ $\cup$ ]0.007806222, +$\infty$[|
| Nivel de confianza| 0.95|


Conclusion:

\(H_{0}\) no puede ser rechazado dado que no se encontró evidencia suficiente para rechazarlo, ya que segÚn lo observado el 0 se encuentra dentro del intervalo de aceptación y el valor p es mayor que el valor de alfa por lo que lo ubica en la region de aceptación, y por ende se asume que la proporciÓn de diamantes de gama alta con color de tipo D se puede considerar similar a la proporciÓn de diamantes de gama baja con color de tipo D.   



## Prueba de hipótesis para una diferencia de promedios usando distribución z

Para este ejemplo se utilizarán dos grupos (los mismo utilizados para la prueba del IC). En primer lugar, está el grupo de diamantes que se considera que tienen un color de buena calidad, este grupo está compuesto de aquellos diamantes cuyo color es "D", "E" o "F". Luego se tiene el grupo diamantes cuyo color es de peor calidad, el cual está compuesto por los diamantes con colores "H", "I" o "J". Ambos grupos están distribuidos de la siguiente manera:

```{r}
buenaCalidad <- diamantes[diamantes$color == "D" | diamantes$color == "E" | diamantes$color == "F",]
peorCalidad <- diamantes[diamantes$color == "H" | diamantes$color == "I" | diamantes$color == "J",]

length(buenaCalidad$color)
length(peorCalidad$color)
```

| Calidad| Colores| Tamaño de muestra|
|:--|:--|:--|
| Buena| D, E o F| `r length(buenaCalidad$color)`|
| Peor| H, I o J| `r length(peorCalidad$color)`|

**Hipótesis asumidas**

Dado que ambas muestras son mayores a 30 se puede asumir que ambas siguen una distribución normal y que se puede aproximar σ₁ y σ₂ mediante s₁  y s₂. Además ambos grupos son independientes.

**Cálculo**

Sea:

* $\mu_{b}$: la media de la profundidad de los diamantes de buena calidad
* $\mu_{m}$: la media de la profundidad de los diamantes de peor calidad

Y dadas las siguientes hipótesis para la prueba:

* $H_{0}: \mu_{b} - \mu_{m} = 0$
* $H_{1}: \mu_{b} - \mu_{m} > 0$

Una vez obtenidos estos datos se procede a realizar la prueba de hipótesis haciendo uso de las siguientes funciones:

```{r}
BSDA::z.test(x = buenaCalidad$profundidad, y = peorCalidad$profundidad, sigma.x = sd(buenaCalidad$profundidad), sigma.y = sd(peorCalidad$profundidad), mu = 0, alternative = "greater")
PASWR2::z.test(x = buenaCalidad$profundidad, y = peorCalidad$profundidad, sigma.x = sd(buenaCalidad$profundidad), sigma.y = sd(peorCalidad$profundidad), mu = 0, alternative = "greater")
```

Ambas funciones aplican para una y dos poblaciones y están compuestas de los siguientes parámetros, en donde:

* **x:** vector numérico que representa la primera muestra
* **y:** vector numérico que representa la segunda muestra (opcional)
* **sigma.x:** desviación estándar de x (opcional)
* **sigma.y:** desviación estándar de y (opcional)
* **mu:** el valor de la media o la diferencia de medias en la hipótesis nula
* **alternative:** indica si la prueba es de cola izquierda (less), derecha (greater) o de dos colas (two.sided)

**Resumen de la prueba**

| Dato| Valor|
|:--|:--|
| Valor observado| $z_{obs}$|
| Estadístico de prueba| $\tilde{x}_b$ y $\tilde{x}_m$|
| Región de aceptación| ]-0.1889905, +$\infty$[|
| Región de rechazo| ]-$\infty$, -0.1889905[|
| Nivel de confianza| 0.95|

**Conclusiones**

No se encontró evidencia en contra $H_{0}$ por lo cual se puede asumir que la media de la profundidad de diamantes con color de mejor calidad es menor a la de los diamantes con color de peor calidad. Esto concordando también con los resultados del valor P, donde se tiene una aceptación fuerte de $H_{0}$.

## Prueba de hipótesis para un cociente de varianzas

Para este caso se utilizarán muestras aleatorias sin reemplazo de tamaño 25 de los dos mismos grupos utilizados en cálculo del IC para diferencia de promedios con distribución t (diamantes con color de buena calidad y diamantes con color de peor calidad).

```{r}
# Se sacan los datos de la calidad
buenaCalidad <- diamantes[diamantes$color == "D" | diamantes$color == "E" | diamantes$color == "F",]
peorCalidad <- diamantes[diamantes$color == "H" | diamantes$color == "I" | diamantes$color == "J",]

# Se toman las filas para las muestras aleatorias
set.seed(6894)
filas.randomMejorCalidad <- sample(1:length(buenaCalidad$color), 25, replace= F)
filas.randomPeorCalidad <- sample(1:length(peorCalidad$color), 25, replace= F)

muestraMejorCalidad <- as.data.frame(buenaCalidad[filas.randomMejorCalidad,])
muestraPeorCalidad <- as.data.frame(peorCalidad[filas.randomPeorCalidad,])

length(muestraMejorCalidad$color)
length(muestraPeorCalidad$color)
```

| Calidad| Colores| Tamaño de muestra|
|:--|:--|:--|
| Buena| D, E o F| `r length(muestraMejorCalidad$color)`|
| Peor| H, I o J| `r length(muestraPeorCalidad$color)`|

Previamente ya se había realizado una prueba de normalidad de estas muestras en el cálculo del IC para diferencia de promedio, sin embargo, aquí se adjunta la prueba de nuevo:

```{r echo=FALSE}
ggdensity(muestraMejorCalidad$profundidad, 
          main = "Gráfico de densidad de la profundidad de la muestra A",
          xlab = "Profundidad de los diamantes")
```

```{r echo=FALSE}
ggdensity(muestraPeorCalidad$profundidad, 
          main = "Gráfico de densidad de la profundidad de la muestra B",
          xlab = "Profundidad de los diamantes")
```

**Hipótesis asumidas**

* El nivel de confianza utilizado será de 95%.
* La población 1 y la población 2 se comportan normalmente.

**Cálculo**

Sea:

* $\sigma^{2}_{b}$: la media de la profundidad de los diamantes de buena calidad
* $\sigma^{2}_{m}$: la media de la profundidad de los diamantes de peor calidad

Y dadas las siguientes hipótesis para la prueba:

* $H_{0}: \frac{\sigma^{2}_{b}}{\sigma^{2}_{m}} = 1$
* $H_{1}: \frac{\sigma^{2}_{b}}{\sigma^{2}_{m}} ≠ 0$

Una vez obtenidos estos datos se procede a realizar la prueba de hipótesis haciendo uso de la siguiente función:

```{r}
stests::var.test(x = muestraMejorCalidad$profundidad, y = muestraPeorCalidad$profundidad)
```

Donde:

* **x:** primera muestra
* **y:** segunda muestra (opcional)
* **alternative:** si es de cola derecha, doble cola o cola izquierda (opcional)
* **null.value:** por defecto es 1 considerando que la relación entre las varianzas es 1. (opcional)
* **conf.level:** nivel de confidencia (opcional)

**Resumen de la prueba**

| Dato| Valor|
|:--|:--|
| Valor observado| $f_{obs}$|
| Grados de libertad| $v_{b} = 24$ $v_{m} = 24$|
| Estadístico de prueba| $\frac{s^{2}_{b}}{s^{2}_{m}}$|
| Región de aceptación| ]1.245114, 6.411864[|
| Región de rechazo| ]-$\infty$, 1.245114[$\cup$]6.411864, +$\infty$[|
| Nivel de confianza| 0.95|

**Conclusiones**

Se llegó a encontrar evidencia contra $H_{0}$ por lo cual se puede asumir que la varianza de la profundidad de diamantes con color de mejor calidad es distinta a la de los diamantes con color de peor calidad. Esto concordando también con los resultados del valor P, donde se tiene un rechazo fuerte de $H_{0}$.


## Prueba de hipótesis para una diferencia de promedios usando distribución t

Para este caso se utilizarán muestras las mismas muestras del ejemplo anterior (diamantes con color de buena calidad y diamantes con color de peor calidad).

```{r}
# Se sacan los datos de la calidad
buenaCalidad <- diamantes[diamantes$color == "D" | diamantes$color == "E" | diamantes$color == "F",]
peorCalidad <- diamantes[diamantes$color == "H" | diamantes$color == "I" | diamantes$color == "J",]

# Se toman las filas para las muestras aleatorias
set.seed(6894)
filas.randomMejorCalidad <- sample(1:length(buenaCalidad$color), 25, replace= F)
filas.randomPeorCalidad <- sample(1:length(peorCalidad$color), 25, replace= F)

muestraMejorCalidad <- as.data.frame(buenaCalidad[filas.randomMejorCalidad,])
muestraPeorCalidad <- as.data.frame(peorCalidad[filas.randomPeorCalidad,])

length(muestraMejorCalidad$color)
length(muestraPeorCalidad$color)
```

| Calidad| Colores| Tamaño de muestra|
|:--|:--|:--|
| Buena| D, E o F| `r length(muestraMejorCalidad$color)`|
| Peor| H, I o J| `r length(muestraPeorCalidad$color)`|

**Hipótesis asumidas**

Por el ejemplo anterior se puede asumir que ambas muestras siguen una distribución normal y que la varianzas son distintas.

**Cálculo**

Sea:

* $\mu_{b}$: la media de la profundidad de los diamantes de buena calidad
* $\mu_{m}$: la media de la profundidad de los diamantes de peor calidad

Y dadas las siguientes hipótesis para la prueba:

* $H_{0}: \mu_{b} - \mu_{m} = 0$
* $H_{1}: \mu_{b} - \mu_{m} > 0$

Una vez obtenidos estos datos se procede a realizar la prueba de hipótesis haciendo uso de las siguientes funciones:

```{r}
t.test(x = muestraMejorCalidad$profundidad, y = muestraPeorCalidad$profundidad, mu = 0, alternative = "greater", var.equal = F)
```

La función está compuesta de los siguientes parámetros, en donde:

* **x:** vector numérico que representa la primera muestra
* **y:** vector numérico que representa la segunda muestra (opcional)
* **mu:** el valor de la media o la diferencia de medias en la hipótesis nula
* **alternative:** indica si la prueba es de cola izquierda (less), derecha (greater) o de dos colas (two.sided)
* **var.equal** indica si las varianzas se asumen iguales

**Resumen de la prueba**

| Dato| Valor|
|:--|:--|
| Valor observado| $t_{obs}$|
| Grados de libertad| 39|
| Estadístico de prueba| $\tilde{x}_b$ y $\tilde{x}_m$|
| Región de aceptación| ]-0.7404251, +$\infty$[|
| Región de rechazo| ]-$\infty$, -0.7404251[|
| Nivel de confianza| 0.95|

**Conclusiones**

No se encontró evidencia en contra $H_{0}$ por lo cual se puede asumir que la media de la profundidad de diamantes con color de mejor calidad es menor a la de los diamantes con color de peor calidad. Esto concordando también con los resultados del valor P, donde se tiene una aceptación fuerte de $H_{0}$.

## Prueba de hipótesis para una varianza

Para este caso de hipótesis se estará usando como muestra la variable de quilates de el dataset diamantes

```{r}
quilates <- diamantes$quilate
```
| Muestra| Tamaño|
|:--|:--|
| Quilates| `r length(quilates)`|

**Hipótesis asumidas**

Antes de realizar el calculo es importante asumir que la muestra sigue una distribución normal

**Cálculo**

Sea:

* $\sigma^2$: la varianza de la variable quilates de la muestra

Y dadas las siguientes hipótesis para la prueba:

* $H_{0}: \sigma =\sqrt{0.2246867} = 0.47401$
* $H_{1}: \sigma ≠ 0.47401$

Una vez obtenidos estos datos se procede a realizar la prueba de hipótesis haciendo uso de las siguientes funciones:

```{r}
sigma.test(x = quilates, sigma = 0.47401, alternative = "two.sided", conf.level = 0.95)
```

La función está compuesta de los siguientes parámetros, en donde:

* **x:** vector numérico que representa la primera muestra
* **sigma:** Es la desviación estandar de la muestra
* **alternative:** indica si la prueba es de cola izquierda (less), derecha (greater) o de dos colas (two.sided)
* **conf.level:** Indica el nivel de confianza con el que se realiza la prueba

**Resumen de la prueba**

| Dato| Valor|
|:--|:--|
| Valor observado| 53939|
| Grados de libertad| 53939|
| Estadístico de prueba| $\s^{2}$|
| Región de aceptación| ]0.2220290, 0.2273925[|
| Región de rechazo| ]-$\infty$, 0.2220290[ $\cup$ ]0.2273925, +[$\infty$|
| Nivel de confianza| 0.95|

**Conclusiones**

No se encontró evidencia en contra de $H_{0}$ por lo cual se puede asumir que la varianza de la muestra si es de 0.2246867, esto debido a que el valor de p Es muy cercano a 1 y porque qué valor dado por la función sobre la varianza muestral si se encuentra entre el intervalo ]0.2220290, 0.2273925[
